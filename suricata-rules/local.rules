# ============================================
# local.rules – Dridex TLS detections 
# ============================================

# 1000011 – Dridex loader JA3 (downloader to truepenesonga)
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"[DRIDEX] Possible loader JA3 detected (3b5074b1b5d032e5620f69f9f700ff0e)";
    flow:established,to_server;
    ja3_hash; content:"3b5074b1b5d032e5620f69f9f700ff0e";
    classtype:trojan-activity;
    sid:1000011; rev:2;
)

# 1000012 – Dridex C2 JA3 (post-infection)
# NOTE: "no SNI" is validated in logs/SIEM, not enforced here.
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"[DRIDEX] C2 JA3 fingerprint detected (51c64c77e60f3980eea90869b68c58a8)";
    flow:established,to_server;
    ja3_hash; content:"51c64c77e60f3980eea90869b68c58a8";
    classtype:trojan-activity;
    sid:1000012; rev:2;
)

# 1000013 – TLS certificate anomalies (randomized CN/Org) – characteristic of Dridex C2
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"[DRIDEX] TLS certificate anomaly (randomized CN/Org) – possible C2";
    flow:established,to_server;
    tls_cert_subject; pcre:"/CN=[A-Za-z0-9]{8,}/";
    tls_cert_issuer;  pcre:"/O=[A-Za-z0-9]{6,}/";
    classtype:trojan-activity;
    sid:1000013; rev:2;
)

# 1000015 – (Optional) Known C2 IPs from Unit42 Dridex PCAP – for lab replay / IOC matching
alert tls $HOME_NET any -> [185.86.148.68,212.95.153.36] any (
    msg:"[DRIDEX] Known C2 IP (Unit42 PCAP IOC)";
    flow:established,to_server;
    classtype:trojan-activity;
    sid:1000015; rev:2;
)

# ============================================
# End
# ============================================
